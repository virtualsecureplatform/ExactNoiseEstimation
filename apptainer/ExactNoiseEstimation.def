Bootstrap: docker
From: julia:1.12.1-bookworm

%labels
    Author virtualsecureplatform
    Description "ExactNoiseEstimation runtime for Alea/Julia scripts on HPC"

%help
    Build:
      apptainer build ExactNoiseEstimation.sif apptainer/ExactNoiseEstimation.def

    Run from repository root (bind current directory):
      apptainer exec --bind $PWD:/work ExactNoiseEstimation.sif \
        bash -lc 'cd /work && julia --project=alea blind_rotate_alea.jl --loops=100'

    Notes:
      - Use --loops=<n> for scaling tests.

%environment
    export LC_ALL=C.UTF-8
    export LANG=C.UTF-8
    export PYTHONUNBUFFERED=1

%post
    set -eux
    export DEBIAN_FRONTEND=noninteractive
    apt-get update
    apt-get install -y --no-install-recommends \
        python3 \
        python3-pip \
        python3-sympy \
        git \
        ca-certificates \
        bash \
        tini
    rm -rf /var/lib/apt/lists/*

%runscript
    exec julia "$@"
